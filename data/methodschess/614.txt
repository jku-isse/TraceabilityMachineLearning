/**
 * The run method to start the animation thread.
 */
public void run() {
    ImageIcon icon = ((ImageIcon) (getPiecesLayer().getPositionRenderer(_ply.getSource().getSquareIndex()).getIcon()));
    JLabel movingPiece = new JLabel(icon);
    // _piece = (PieceRenderer)icon.getImage();
    getPiecesLayer().getPositionRenderer(_ply.getSource().getSquareIndex()).setIcon(null);
    getPiecesLayer().repaint();
    int xOffset = ((ChessBoardRenderer2D.getSquareSize()) - (icon.getIconWidth())) / 2;
    int yOffset = ((ChessBoardRenderer2D.getSquareSize()) - (icon.getIconHeight())) / 2;
    _currentPoint = new Point(((((_ply.getSource().getSquareIndex()) & 7) * (ChessBoardRenderer2D.getSquareSize())) + xOffset), (((7 - ((_ply.getSource().getSquareIndex()) >> 3)) * (ChessBoardRenderer2D.getSquareSize())) + yOffset));
    Point endPoint = new Point(((((_ply.getDestination().getSquareIndex()) & 7) * (ChessBoardRenderer2D.getSquareSize())) + xOffset), (((7 - ((_ply.getDestination().getSquareIndex()) >> 3)) * (ChessBoardRenderer2D.getSquareSize())) + yOffset));
    int xMoveOffset = ((_currentPoint.x) < (endPoint.x)) ? 1 : (_currentPoint.x) > (endPoint.x) ? -1 : 0;
    int yMoveOffset = ((_currentPoint.y) < (endPoint.y)) ? 1 : (_currentPoint.y) > (endPoint.y) ? -1 : 0;
    movingPiece.setLocation(_currentPoint);
    while (!(_currentPoint.equals(endPoint))) {
        if ((_currentPoint.x) == (endPoint.x)) {
            xMoveOffset = 0;
        }
        if ((_currentPoint.y) == (endPoint.y)) {
            yMoveOffset = 0;
        }
        _currentPoint.x += xMoveOffset;
        _currentPoint.y += yMoveOffset;
        // invalidate();
        // repaint();
        // paint( getGraphics());
        // getGraphics().drawImage( _piece, _currentPoint.x, _currentPoint.y, this);
        movingPiece.setLocation(_currentPoint);
        paintImmediately(((_currentPoint.x) - 1), ((_currentPoint.y) - 1), ChessBoardRenderer2D.getSquareSize(), ChessBoardRenderer2D.getSquareSize());
        try {
            Thread.sleep(5);
        } catch (InterruptedException ignored) {
        }
        // getGraphics().clearRect( _currentPoint.x - 1, _currentPoint.y - 1, ChessBoardRenderer2D.getSquareSize() + 1, ChessBoardRenderer2D.getSquareSize() + 1);
    } 
    movingPiece.setVisible(false);
    getPiecesLayer().getPositionRenderer(_ply.getDestination().getSquareIndex()).setIcon(icon);
    _ply = null;
    _animationThread = null;
}