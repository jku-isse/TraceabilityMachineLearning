public final PlyNotation ply() throws RecognitionException, TokenStreamException {
    PlyNotation notation = null;
    Token lc = null;
    Token snOrg = null;
    Token snDest = null;
    Token lc2 = null;
    PGNPlyFragment plyFragment = new PGNPlyFragment();
    {
        switch (LA(1)) {
            case PGNTokenTypes.FIGURINE_LETTER_CODE :
            case PGNTokenTypes.SQUARE_NAME :
            case PGNTokenTypes.PIECE_MOVE :
            case PGNTokenTypes.PIECE_CAPTURE :
                {
                    {
                        {
                            switch (LA(1)) {
                                case PGNTokenTypes.FIGURINE_LETTER_CODE :
                                    {
                                        lc = LT(1);
                                        match(PGNTokenTypes.FIGURINE_LETTER_CODE);
                                        plyFragment.setPieceTypeFromLetter(lc.getText().charAt(0));
                                        break;
                                    }
                                case PGNTokenTypes.SQUARE_NAME :
                                case PGNTokenTypes.PIECE_MOVE :
                                case PGNTokenTypes.PIECE_CAPTURE :
                                    {
                                        break;
                                    }
                                default :
                                    {
                                        throw new antlr.NoViableAltException(LT(1), getFilename());
                                    }
                            }
                        }
                        {
                            {
                                switch (LA(1)) {
                                    case PGNTokenTypes.SQUARE_NAME :
                                        {
                                            snOrg = LT(1);
                                            match(PGNTokenTypes.SQUARE_NAME);
                                            plyFragment.setOrigin(snOrg.getText());
                                            break;
                                        }
                                    case PGNTokenTypes.PIECE_MOVE :
                                    case PGNTokenTypes.PIECE_CAPTURE :
                                        {
                                            break;
                                        }
                                    default :
                                        {
                                            throw new antlr.NoViableAltException(LT(1), getFilename());
                                        }
                                }
                            }
                            {
                                switch (LA(1)) {
                                    case PGNTokenTypes.PIECE_MOVE :
                                        {
                                            match(PGNTokenTypes.PIECE_MOVE);
                                            plyFragment.setCapture(false);
                                            break;
                                        }
                                    case PGNTokenTypes.PIECE_CAPTURE :
                                        {
                                            match(PGNTokenTypes.PIECE_CAPTURE);
                                            plyFragment.setCapture(true);
                                            break;
                                        }
                                    default :
                                        {
                                            throw new antlr.NoViableAltException(LT(1), getFilename());
                                        }
                                }
                            }
                            snDest = LT(1);
                            match(PGNTokenTypes.SQUARE_NAME);
                            plyFragment.setDestination(snDest.getText());
                        }
                        {
                            switch (LA(1)) {
                                case PGNTokenTypes.PAWN_PROMOTION :
                                    {
                                        match(PGNTokenTypes.PAWN_PROMOTION);
                                        lc2 = LT(1);
                                        match(PGNTokenTypes.FIGURINE_LETTER_CODE);
                                        if (!((!("P".equals(lc2.getText()))) && (!("K".equals(lc2.getText())))))
                                            throw new SemanticException(" ! "P".equals( lc2.getText()) && ! "K".equals( lc2.getText())");

                                        plyFragment.setPawnPromotion(lc2.getText().charAt(0));
                                        break;
                                    }
                                case PGNTokenTypes.GAME_TERMINATOR :
                                case PGNTokenTypes.MOVE_INDEX :
                                case PGNTokenTypes.FIGURINE_LETTER_CODE :
                                case PGNTokenTypes.SQUARE_NAME :
                                case PGNTokenTypes.PIECE_MOVE :
                                case PGNTokenTypes.PIECE_CAPTURE :
                                case PGNTokenTypes.LEFT_CASTLING :
                                case PGNTokenTypes.RIGHT_CASTLING :
                                case PGNTokenTypes.WS :
                                    {
                                        break;
                                    }
                                default :
                                    {
                                        throw new antlr.NoViableAltException(LT(1), getFilename());
                                    }
                            }
                        }
                    }
                    break;
                }
            case PGNTokenTypes.LEFT_CASTLING :
                {
                    match(PGNTokenTypes.LEFT_CASTLING);
                    plyFragment.setCastling(true);
                    break;
                }
            case PGNTokenTypes.RIGHT_CASTLING :
                {
                    match(PGNTokenTypes.RIGHT_CASTLING);
                    plyFragment.setCastling(false);
                    break;
                }
            default :
                {
                    throw new antlr.NoViableAltException(LT(1), getFilename());
                }
        }
    }
    // When we have all the info from the PGN file, we can try to
    // create a ply notation from it.
    notation = getGameLoader().completePly(plyFragment);
    if (!(notation != null))
        throw new SemanticException("notation != null");

    return notation;
}