/* Precondition:
Patient 2 and HCP 9000000000 are in the system. 
Patient 2 had an office visit with HCP 9000000000 on 6/10/2007. 
Patient 2 has successfully authenticated.
Description:
Patient 2 chooses to view his records.
Patient 2 clicks a link next to his office visit on 6/10/2007 to take satisfaction survey.
He inputs the following information and submits:
[none] 
10 minutes 
3 
[none]
Expected Results:
The survey answers are stored and the event is logged.
 */
public void testTakeSatisfactionSurveySuccess2() throws Exception {
    WebConversation wc = login("2", "pw");
    WebResponse wr = wc.getCurrentPage();
    assertEquals("iTrust - Patient Home", wr.getTitle());
    iTrustHTTPTest.assertLogged(TransactionType.HOME_VIEW, 2L, 0L, "");
    wr = wr.getLinkWith("My Records").click();
    assertTrue(wr.getText().contains("Patient Information"));
    iTrustHTTPTest.assertLogged(TransactionType.MEDICAL_RECORD_VIEW, 2L, 2L, "");
    WebTable wt = wr.getTableStartingWith("Office Visits");
    wr = wt.getTableCell(1, 1).getLinkWith("Complete Visit Survey").click();
    assertTrue(wr.getText().contains("iTrust Patient Survey for Office Visit on Jun 10, 2007"));
    WebForm form = wr.getForms()[0];
    form.setParameter("examMinutesString", "10");
    form.setParameter("Satradios", "satRadio3");
    wr = form.submit();
    assertTrue(wr.getText().contains("Survey Successfully Submitted"));
    iTrustHTTPTest.assertLogged(TransactionType.SATISFACTION_SURVEY_TAKE, 2L, 2L, "");
    // make sure survey cannot be taken again
    wt = wr.getTableStartingWith("Office Visits");
    try {
        wr = wt.getTableCell(1, 1).getLinkWith("Complete Visit Survey").click();
        fail("the link should have disappeared");
    } catch (NullPointerException ex) {
        assertEquals(null, ex.getMessage());
    }
}