public void testAddPrescription_Allergy() throws Exception {
    action = new EditPrescriptionsAction(factory, 9000000000L, "100", "1093");
    PrescriptionBean pres = new PrescriptionBean();
    pres.setDosage(50);
    pres.setInstructions("Take it");
    pres.setStartDateStr("01/31/2011");
    pres.setEndDateStr("02/12/2011");
    MedicationBean med = factory.getNDCodesDAO().getNDCode("00882219");
    pres.setMedication(med);
    pres.setVisitID(1093);
    try {
        action.addPrescription(pres);
        fail("Should have thrown exception");
    } catch (PrescriptionWarningException e) {
        assertTrue(e.getDisplayMessage().contains("Allergy: Lantus"));
    } catch (Exception e) {
        fail("Wrong exception thrown");
    }
}