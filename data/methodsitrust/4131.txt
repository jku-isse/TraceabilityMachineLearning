public void testPatientSendsMessageToReceivingHCP() throws Exception {
    gen.patient2();
    gen.referrals();
    WebConversation wc = login("2", "pw");
    WebResponse wr = wc.getCurrentPage();
    assertEquals("iTrust - Patient Home", wr.getTitle());
    // click Document Office Visit
    wr = wr.getLinkWith("My Referrals").click();
    // Pull up the details of the very first referral in the table
    wr = wc.getCurrentPage();
    WebTable tbl = wr.getTableWithID("patientReferralsTable");
    assertEquals("Gandalf Stormcrow", tbl.getTableCell(3, 1).getText());
    assertEquals("07/15/2007 00:00 AM", tbl.getTableCell(3, 2).getText());
    tbl.getTableCell(3, 3).getLinkWith("View").click();
    // Click on link to send a message
    wr = wc.getCurrentPage();
    assertEquals("iTrust - View Referrals", wr.getTitle());
    WebTable reftbl = wr.getTableWithID("patientViewingReferral");
    assertEquals("06/10/2007", reftbl.getTableCell(2, 3).getText());
    assertEquals("Gandalf will make sure that the virus does not get past your immune system", reftbl.getTableCell(2, 4).getText());
    reftbl.getTableCell(2, 6).getLinkWith("Email Gandalf Stormcrow").click();
    // Fill out the message box and submit a message to the receiving HCP
    wr = wc.getCurrentPage();
    assertEquals("iTrust - View Referrals", wr.getTitle());
    assertTrue(wr.getText().contains("To Gandalf Stormcrow"));
    WebForm form = wr.getForms()[2];
    form.setParameter("messageBody", "I want an appointment!");
    form.getButtons()[0].click();
    // Check to see if there is a success message.
    wr = wc.getCurrentPage();
    assertTrue(wr.getText().contains("Your message has successfully been sent!"));
}