public void testUpdateProcedure() throws Exception {
    LabProcedureBean lp = new LabProcedureBean();
    lp.setLoinc("10763-1");
    lp.setCommentary("This is a routine procedure");
    lp.setOvID(902L);
    lp.setPid(2L);
    lp.setResults("");
    lp.allow();
    lp.statusPending();
    long id = lpDAO.addLabProcedure(lp);
    lp.setProcedureID(id);
    lp.statusComplete();
    lp.setResults("No abnormal results");
    gen.fakeEmail();
    action.updateProcedure(lp);
    LabProcedureBean procedures = lpDAO.getLabProcedure(id);
    assertEquals(LabProcedureBean.Completed, procedures.getStatus());
    assertEquals("No abnormal results", procedures.getResults());
    List<Email> list = feDAO.getAllEmails();
    assertEquals("Dear Andy Programmer, 
 Your Lab Procedure (10763-1) has a new updated status of Completed. Log on to iTrust to view.", list.get(0).getBody());
}