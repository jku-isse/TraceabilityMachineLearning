public void testCreateNewReferral() throws Exception {
    gen.officeVisit3();
    // login
    WebConversation wc = login("9000000000", "pw");
    WebResponse wr = wc.getCurrentPage();
    assertEquals("iTrust - HCP Home", wr.getTitle());
    // click Document Office Visit
    wr = wr.getLinkWith("Document Office Visit").click();
    // select the patient
    WebForm form = wr.getForms()[0];
    form.getScriptableObject().setParameterValue("UID_PATIENTID", "1");
    form.getButtons()[1].click();
    wr = wc.getCurrentPage();
    assertEquals(((iTrustHTTPTest.ADDRESS) + "auth/hcp-uap/documentOfficeVisit.jsp"), wr.getURL().toString());
    // Select the office visit from specific date
    wr.getLinkWith("9/17/2009").click();
    wr = wc.getCurrentPage();
    assertEquals("iTrust - Document Office Visit", wr.getTitle());
    // click on the add referral button
    form = wr.getFormWithID("createReferralForm");
    form.getButtonWithID("add_referral").click();
    // select the HCP
    wr = wc.getCurrentPage();
    assertEquals("iTrust - Please Select a Personnel", wr.getTitle());
    form = wr.getForms()[1];
    form.setParameter("FIRST_NAME", "Gandalf");
    form.setParameter("LAST_NAME", "Stormcrow");
    form.getButtons()[2].click();
    wr = wc.getCurrentPage();
    wr.getForms()[2].getButtons()[0].click();
    // we should be on the edit referral page now
    wr = wc.getCurrentPage();
    assertEquals("iTrust - Edit Referral", wr.getTitle());
    // fill in the form
    form = wr.getFormWithID("editReferralForm");
    form.setParameter("priority", "1");
    form.setParameter("referralDetails", "See Gandalf.  He will translate the engravings on that ring for you.");
    form.getButtonWithID("submitCreate").click();
    // we should be back on the edit office visit page
    wr = wc.getCurrentPage();
    assertEquals("iTrust - Document Office Visit", wr.getTitle());
    // see that referral is now in the table
    WebTable tbl = wr.getTableWithID("referralsTable");
    assertEquals("Gandalf Stormcrow", tbl.getCellAsText(2, 0));// receiving HCP

    assertEquals("See Gandalf. He will translate the engravings on that ring for you.", tbl.getCellAsText(2, 1));// notes

    assertEquals("1", tbl.getCellAsText(2, 2));// priority

    String datestr = new SimpleDateFormat("MM/dd/yyyy").format(new Date());
    assertTrue(tbl.getCellAsText(2, 3).contains(datestr));// time stamp

}