/* HCP 9000000000 prescribed Citalopram Hydrobromide (54868-4985) 
to Patient 2 (on his 5/10/2007 Office Visit) 
with start date 6/15/2007, end date 12/15/2007, 
dosage 10mg, and instructions ?Take once daily with water? 

Patient 2 has reported an Adverse Event for the prescription drug 
Citalopram Hydrobromide (54868-4985) on 8/12/2007 at 3:10PM 
with description ?Stomach cramps and migraine headaches after taking this drug? 

Authenticate PHA
MID: 7000000001
Password: pw
Choose option Monitor Adverse Events
Choose date range 02/05/1990 through 10/15/2009
Choose to view adverse events
Select the 8/12/2007 Adverse Event Report by Andy Programmer, 
for prescription drug Citalopram Hydrobromide (ND Code: 54868-4985)
Send email to patient requesting more information
 */
public void testViewDrugAdverseEvents() throws Exception {
    gen.adverseEvent1();
    // login pha
    WebConversation wc = login("7000000001", "pw");
    WebResponse wr = wc.getCurrentPage();
    assertEquals("iTrust - PHA Home", wr.getTitle());
    iTrustHTTPTest.assertLogged(TransactionType.HOME_VIEW, 7000000001L, 0L, "");
    // click Monitor Adverse Events
    wr = wr.getLinkWith("Monitor Adverse Events").click();
    assertEquals("iTrust - Monitor Adverse Events", wr.getTitle());
    // choose date range
    WebForm form = wr.getForms()[0];
    form.getScriptableObject().setParameterValue("startDate", "02/05/1990");
    form.getScriptableObject().setParameterValue("endDate", "10/15/2009");
    form.getButtons()[2].click();
    wr = wc.getCurrentPage();
    assertTrue(wr.getText().contains("Citalopram Hydrobromide(548684985)"));
    // get details of report
    wr = wr.getLinkWith("Get Details").click();
    iTrustHTTPTest.assertLogged(TransactionType.ADVERSE_EVENT_VIEW, 7000000001L, 0L, "");
    assertTrue(wr.getText().contains("Andy Programmer"));
    assertTrue(wr.getText().contains("Citalopram Hydrobromide (548684985)"));
    assertTrue(wr.getText().contains("2007-08-12 15:10:00.0"));
    assertTrue(wr.getText().contains("Stomach cramps and migraine headaches after taking this drug"));
    // request more information
    form = wr.getForms()[0];
    form.getButtons()[1].click();
    wr = wc.getCurrentPage();
    assertTrue(wr.getText().contains("Request sent"));
    iTrustHTTPTest.assertLogged(TransactionType.ADVERSE_EVENT_REQUEST_MORE, 7000000001L, 0L, "Requested more info");
}