static File proposeOutputFile(IGanttProject project, Exporter exporter) {
    String proposedExtension = exporter.proposeFileExtension();
    if (proposedExtension == null) {
        return null;
    }
    if ((FileChooserPage.ourLastSelectedFile) != null) {
        String name = FileChooserPage.ourLastSelectedFile.getAbsolutePath();
        int lastDot = name.lastIndexOf(.);
        String extension = (lastDot >= 0) ? name.substring((lastDot + 1)) : "";
        if (extension.equals(proposedExtension)) {
            return FileChooserPage.ourLastSelectedFile;
        }
    }
    File userHome = new File(System.getProperty("user.home"));
    File result = new File(userHome, (((project.getProjectName()) + ".") + proposedExtension));
    Document projectDocument = project.getDocument();
    if (projectDocument != null) {
        File localFile = new File(projectDocument.getFilePath());
        if (localFile.exists()) {
            String name = localFile.getAbsolutePath();
            int lastDot = name.lastIndexOf(.);
            name = ((name.substring(0, lastDot)) + ".") + proposedExtension;
            result = new File(name);
        } else {
            File directory = localFile.getParentFile();
            if (directory.exists()) {
                result = new File(directory, (((project.getProjectName()) + ".") + proposedExtension));
            }
        }
    }
    return result;
}