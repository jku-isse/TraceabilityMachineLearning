@Override
public void read(InputStream in, Drawing drawing, boolean replace) throws IOException {
    BufferedInputStream bin = (in instanceof BufferedInputStream) ? ((BufferedInputStream) (in)) : new BufferedInputStream(in);
    bin.mark(2);
    int magic = ((bin.read()) & 255) | (((bin.read()) & 255) << 8);
    bin.reset();
    if (magic == (GZIPInputStream.GZIP_MAGIC)) {
        super.read(new GZIPInputStream(bin), drawing, replace);
    } else {
        super.read(bin, drawing, replace);
    }
}