public void read(Transferable t, Drawing drawing, boolean replace) throws UnsupportedFlavorException, IOException {
    // 1. Try to read the image using the Java Image Flavor
    // This causes a NoSuchMethodError to be thrown on Mac OS X 10.5.2.
    if (t.isDataFlavorSupported(DataFlavor.imageFlavor)) {
        try {
            Image img = ((Image) (t.getTransferData(DataFlavor.imageFlavor)));
            img = Images.toBufferedImage(img);
            ImageHolderFigure figure = ((ImageHolderFigure) (prototype.clone()));
            figure.setBufferedImage(((BufferedImage) (img)));
            figure.setBounds(new Point2D.Double(0, 0), new Point2D.Double(figure.getBufferedImage().getWidth(), figure.getBufferedImage().getHeight()));
            LinkedList<Figure> list = new LinkedList<Figure>();
            list.add(figure);
            if (replace) {
                drawing.removeAllChildren();
            }
            drawing.addAll(list);
            return;
        } catch (Throwable e) {
            // no need to do anything here, because we try to read the
            // image/png below.
            // e.printStackTrace();
        }
    }
    // 2. Try to read the image using our own image/png flavor.
    if (t.isDataFlavorSupported(ImageTransferable.IMAGE_PNG_FLAVOR)) {
        try {
            InputStream in = ((InputStream) (t.getTransferData(ImageTransferable.IMAGE_PNG_FLAVOR)));
            Image img = ImageIO.read(in);
            img = Images.toBufferedImage(img);
            ImageHolderFigure figure = ((ImageHolderFigure) (prototype.clone()));
            figure.setBufferedImage(((BufferedImage) (img)));
            figure.setBounds(new Point2D.Double(0, 0), new Point2D.Double(figure.getBufferedImage().getWidth(), figure.getBufferedImage().getHeight()));
            LinkedList<Figure> list = new LinkedList<Figure>();
            list.add(figure);
            if (replace) {
                drawing.removeAllChildren();
            }
            drawing.addAll(list);
        } catch (Throwable e) {
            e.printStackTrace();
            IOException ex = new IOException("Couldnt import image as image/png flavor");
            ex.initCause(e);
            throw ex;
        }
    } else {
        throw new IOException("Couldnt import image.");
    }
}