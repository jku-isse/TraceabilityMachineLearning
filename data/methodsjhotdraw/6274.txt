/**
 * Converts an Image to BufferedImage. If the Image is already a
 * BufferedImage, the same image is returned.
 *
 * @param rImg
 * 		An Image.
 * @return A BufferedImage.
 */
public static BufferedImage toBufferedImage(RenderedImage rImg) {
    BufferedImage image;
    if (rImg instanceof BufferedImage) {
        image = ((BufferedImage) (rImg));
    } else {
        Raster r = rImg.getData();
        WritableRaster wr = WritableRaster.createWritableRaster(r.getSampleModel(), null);
        rImg.copyData(wr);
        image = new BufferedImage(rImg.getColorModel(), wr, rImg.getColorModel().isAlphaPremultiplied(), null);
    }
    return image;
}