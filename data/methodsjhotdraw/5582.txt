@Override
public void paint(Graphics g) {
    super.paint(g);
    final int state = getDisclosureState();
    if ((runner) == null) {
        runner = new Runnable() {
            public void run() {
                try {
                    // long start = System.currentTimeMillis();
                    panels[state] = createDisclosedComponent(state);
                } catch (Throwable t) {
                    t.printStackTrace();
                    panels[state] = null;
                }
                // long end = System.currentTimeMillis();
                // System.out.println(AbstractToolBar.this.getClass()+" state:"+state+" elapsed:"+(end-start));
                JComponent parent = ((JComponent) (getParent()));
                if (parent != null) {
                    GridBagLayout layout = ((GridBagLayout) (parent.getLayout()));
                    GridBagConstraints gbc = layout.getConstraints(AbstractToolBar.ProxyPanel.this);
                    parent.remove(AbstractToolBar.ProxyPanel.this);
                    if ((getDisclosureState()) == state) {
                        if ((panels[state]) != null) {
                            parent.add(panels[state], gbc);
                        } else {
                            JPanel empty = new JPanel(new BorderLayout());
                            empty.setOpaque(false);
                            parent.add(empty, gbc);
                        }
                    }
                    parent.revalidate();
                    ((JComponent) (parent.getRootPane().getContentPane())).revalidate();
                }
            }
        };
        SwingUtilities.invokeLater(runner);
    }
}